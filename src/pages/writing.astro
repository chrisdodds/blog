---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");
const fictionPost = allPosts.find((p) => p.slug === "2025-12-16-a-good-mother");
const nonfictionPost = allPosts.find((p) => p.slug === "2025-10-07-you-cant-rent-swim-trunks");

// Manual entries for external publications
const externalPublications = {
  fiction: [
    // Add external fiction publications here
    // Example:
    // {
    //   title: "Story Title",
    //   description: "Published in Magazine Name",
    //   url: "https://example.com/story",
    //   date: "2025-01-15",
    // },
  ],
  nonfiction: [
    // Add external non-fiction publications here
    // Example:
    // {
    //   title: "Article Title",
    //   description: "Published in Publication Name",
    //   url: "https://example.com/article",
    //   date: "2025-01-15",
    // },
  ],
};

// Combine blog posts and external publications
const fictionItems = [
  ...(fictionPost
    ? [
        {
          title: fictionPost.data.title,
          description: fictionPost.data.description,
          slug: fictionPost.slug,
          date: fictionPost.data.pubDate,
        },
      ]
    : []),
  ...externalPublications.fiction.map((pub) => ({
    ...pub,
    date: typeof pub.date === "string" ? new Date(pub.date) : pub.date,
  })),
];

const nonfictionItems = [
  ...(nonfictionPost
    ? [
        {
          title: nonfictionPost.data.title,
          description: nonfictionPost.data.description,
          slug: nonfictionPost.slug,
          date: nonfictionPost.data.pubDate,
        },
      ]
    : []),
  ...externalPublications.nonfiction.map((pub) => ({
    ...pub,
    date: typeof pub.date === "string" ? new Date(pub.date) : pub.date,
  })),
];
---

<Layout title="Writing - Chris Dodds">
  <main id="main-content">
    <Header />

    <section class="writing">
      <h1>Writing</h1>

      <div class="writing-section">
        <h2>Fiction</h2>
        <ul>
          {fictionItems.map((item) => {
            const href = item.url || (item.slug ? `/blog/${item.slug}/` : "#");
            const isExternal = !!item.url;
            return (
              <li class="writing-item">
                <a
                  href={href}
                  class="writing-title"
                  {...(isExternal
                    ? { target: "_blank", rel: "noopener noreferrer" }
                    : {})}
                >
                  {item.title}
                </a>
                <p class="writing-description">{item.description}</p>
                <time class="writing-date" datetime={item.date.toISOString()}>
                  {item.date.toLocaleDateString("en-us", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })}
                </time>
              </li>
            );
          })}
        </ul>
      </div>

      <div class="writing-section">
        <h2>Non-Fiction</h2>
        <ul>
          {nonfictionItems.map((item) => {
            const href = item.url || (item.slug ? `/blog/${item.slug}/` : "#");
            const isExternal = !!item.url;
            return (
              <li class="writing-item">
                <a
                  href={href}
                  class="writing-title"
                  {...(isExternal
                    ? { target: "_blank", rel: "noopener noreferrer" }
                    : {})}
                >
                  {item.title}
                </a>
                <p class="writing-description">{item.description}</p>
                <time class="writing-date" datetime={item.date.toISOString()}>
                  {item.date.toLocaleDateString("en-us", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })}
                </time>
              </li>
            );
          })}
        </ul>
      </div>
    </section>
  </main>
</Layout>

<style>
  .writing h1 {
    font-size: 2rem;
    margin-bottom: 2.5rem;
  }

  .writing-section {
    margin-bottom: 3rem;
  }

  .writing-section:not(:last-child) {
    padding-bottom: 2rem;
    border-bottom: 1px solid #eee;
  }

  .writing-section h2 {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    color: #333;
  }

  .writing-section ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .writing-item {
    margin-bottom: 0;
  }

  .writing-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #0066cc;
    text-decoration: none;
    display: block;
    margin-bottom: 0.5rem;
  }

  .writing-title:hover {
    text-decoration: underline;
  }

  .writing-description {
    font-size: 1rem;
    color: #555;
    margin: 0 0 0.5rem 0;
    line-height: 1.6;
  }

  .writing-date {
    font-size: 0.875rem;
    color: #777;
    display: block;
  }
</style>

