---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";

export async function getStaticPaths({ paginate }) {
  const allPosts = (await getCollection("blog")).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );

  return paginate(allPosts, { pageSize: 5 });
}

const { page } = Astro.props;
---

<Layout title="Blog - Chris Dodds">
  <main>
    <Header />

    <section class="posts">
      {
        page.data.map((post) => (
          <article class="post-preview">
            <a href={`/blog/${post.slug}/`}>
              <h2>{post.data.title}</h2>
              <time datetime={post.data.pubDate.toISOString()}>
                {post.data.pubDate.toLocaleDateString("en-us", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </time>
              <p>{post.data.description}</p>
            </a>
          </article>
        ))
      }
    </section>

    <nav class="pagination" aria-label="Pagination">
      {page.url.prev ? (
        <a href={page.url.prev}>← Newer</a>
      ) : (
        <span class="disabled" aria-hidden="true">← Newer</span>
      )}
      {page.url.next ? (
        <a href={page.url.next}>Older →</a>
      ) : (
        <span class="disabled" aria-hidden="true">Older →</span>
      )}
    </nav>
  </main>
</Layout>
